<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button href="/tabs/profile">
        <ion-icon size="medium" name="chevron-back-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>My Listings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Search and Filter Bar -->
  <div class="nav-container">
    <ion-searchbar [(ngModel)]="searchText" placeholder="Quick search by pet name, species, or city." debounce="300"
      animated="true" class="mylist-search">
    </ion-searchbar>
    <ion-button fill="clear" shape="round" color="primary" (click)="openFilterModal()">
      <ion-icon slot="icon-only" name="filter-outline"></ion-icon>
    </ion-button>
  </div>

  <!-- Pets Card -->
  <ion-list>
    <ion-card *ngFor="let pet of filteredPets">
      <div class="summary-row">
        <ion-img *ngIf="pet.photos && pet.photos.length > 0" [src]="pet.photos[0]" class="pet-photo"></ion-img>
        <div class="summary-content">
          <div>
            <div class="pet-title">{{ pet.petName }}</div>
            <div class="pet-subtitle">
              {{ getSpeciesLabel(pet.species) }} <br> {{ getAgeDisplay(pet) }}
            </div>
          </div>
          <div class="action-icons">
            <ion-button fill="clear" size="small" (click)="editPet(pet)">
              <ion-icon name="create-outline"></ion-icon>
            </ion-button>
            <ion-button fill="clear" size="small" (click)="toggleAccordion(pet.id)">
              <ion-icon [name]="isAccordionOpen(pet.id) ? 'remove-outline' : 'add-outline'"></ion-icon>
            </ion-button>
          </div>
        </div>
      </div>

      <!-- Accordion Details -->
      <div *ngIf="isAccordionOpen(pet.id)" class="accordion-details">
        <div class="info-row"><b>Description</b>: <span>{{ pet.description }}</span></div>
        <div class="info-row"><b>Location</b>: <span>{{ pet.location }}</span></div>
        <div class="info-row" *ngIf="pet.contactName && pet.contactPublic"><b>Contact Name</b>: <span>{{ pet.contactName
            }}</span></div>
        <div class="info-row" *ngIf="pet.contactPhone && pet.contactPublic"><b>Contact Phone</b>: <span>{{
            pet.contactPhone }}</span></div>
        <div class="info-row"><b>Health</b>: <span>{{ pet.health || 'Not specified' }}</span></div>
        <div class="info-row"><b>Temperament</b>: <span>{{ pet.temperament || 'Not specified' }}</span></div>
        <div class="info-row"><b>Status</b>: <span class="status"
            [ngClass]="{'pending': pet.status === 'Pending', 'active': pet.status === 'Active'}">
            {{ pet.status }} </span></div>
      </div>
    </ion-card>
  </ion-list>

  <div *ngIf="filteredPets.length === 0" class="no-data">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>No adoption listings found. Add one via the submission form!</p>
  </div>

</ion-content>